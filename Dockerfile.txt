FROM python:3.9-slim

# Install system dependencies
RUN apt-get update && \
    apt-get install -y git wget ffmpeg libsm6 libxext6 && \
    pip install --upgrade pip

# Set working directory
WORKDIR /app

# Copy your app.py
COPY app.py .

# Clone Wav2Lip-GFPGAN
RUN git clone https://github.com/ajay-sainy/Wav2Lip-GFPGAN.git

# Download models
RUN mkdir -p Wav2Lip-GFPGAN/Wav2Lip-master/face_detection/detection/sfd && \
    wget https://www.adrianbulat.com/downloads/python-fan/s3fd-619a316812.pth \
    -O Wav2Lip-GFPGAN/Wav2Lip-master/face_detection/detection/sfd/s3fd.pth

# Download pretrained Wav2Lip model
RUN pip install gdown && \
    gdown https://drive.google.com/uc?id=1fQtBSYEyuai9MjBOF8j7zZ4oQ9W2N64q \
    -O Wav2Lip-GFPGAN/Wav2Lip-master/checkpoints/wav2lip.pth

# Install Python dependencies
RUN pip install -r Wav2Lip-GFPGAN/Wav2Lip-master/requirements.txt && \
    pip install flask

# Expose port
EXPOSE 5000

# Run the API
CMD ["python", "app.py"]
